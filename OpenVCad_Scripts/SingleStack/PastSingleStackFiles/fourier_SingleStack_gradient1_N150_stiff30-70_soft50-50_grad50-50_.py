# ── SinglStack.py ────────────────────────────────────────────────────────────────
import pyvcad as pv

#-- STL File Directory --
STL_Location = "MAC_LAB/STL Files/VariableSingleStack/Diameter_40mm--WallThickness_1-0mm/"

#-- Material definitions --
materials = pv.MaterialDefs("configs/default.json")
red = materials.id("red")  # Agilus
blue = materials.id("blue")  # Vero
liquid_mat = materials.id("liquid")  # Liquid matieral
# Structural material is 95% vero and 5% agilus
# Support Material for support inside liquid and bellows
green = materials.id("green")

#-- Dimensions of part --
mainHeight = 5   # Dr. Mac's: 3.5[mm]
mainD = 40    # Dr. Mac's: 25[mm]
capHeight = 2 #[mm]

#-- Stack Settings --
numStacks = 4
includeBaffles = False

#-- placing stuff --
x = 6.184830
y = 6.177406
z = 0

#-- Defining Root Node --
root = pv.Union()

#----------------------
#-- Importing meshes --
#----------------------

#outter bellow
bellows1 = pv.Mesh(
    STL_Location + "/variableNumberBellowsStack_ASSEMBLY - Variable_Bellow-1.STL", red)
bellows1 = pv.Translate(-x-mainD/2, -y-mainD/2,0 , bellows1)

# === MATERIAL GRADING ===
# Gradient Type: gradient1
# Design Type: Single stack
# Stiff Section Settings: 70% Vero, 30% Agilus
# Soft  Section Settings: 50% Vero, 50% Agilus
# Gradient Start / End:   50% → 50%
# Gradient4 Vero/Agilus:  50% / 50%
#
# N (number of Fourier modes) = 150,  L = 25
#

# Use the computed Fourier‐series strings in the call below:
bellows_fgrade = pv.FGrade(
    [
          "0.5490068871 +0.0140655540 * cos(1*pi ((x^2 + y^2)^0.5)/25) +0.0044672390 * cos(2*pi ((x^2 + y^2)^0.5)/25) +0.0542988135 * cos(3*pi ((x^2 + y^2)^0.5)/25) -0.1117630844 * cos(4*pi ((x^2 + y^2)^0.5)/25) -0.1572239696 * cos(5*pi ((x^2 + y^2)^0.5)/25) +0.0510468026 * cos(6*pi ((x^2 + y^2)^0.5)/25) +0.0762308358 * cos(7*pi ((x^2 + y^2)^0.5)/25) -0.0004423028 * cos(8*pi ((x^2 + y^2)^0.5)/25) +0.0674594490 * cos(9*pi ((x^2 + y^2)^0.5)/25) +0.0414764748 * cos(10*pi ((x^2 + y^2)^0.5)/25) -0.0543383461 * cos(11*pi ((x^2 + y^2)^0.5)/25) -0.0159820846 * cos(12*pi ((x^2 + y^2)^0.5)/25) -0.0140481824 * cos(13*pi ((x^2 + y^2)^0.5)/25) -0.0574648420 * cos(14*pi ((x^2 + y^2)^0.5)/25) +0.0045475721 * cos(15*pi ((x^2 + y^2)^0.5)/25) +0.0289219376 * cos(16*pi ((x^2 + y^2)^0.5)/25) -0.0032612538 * cos(17*pi ((x^2 + y^2)^0.5)/25) +0.0345585072 * cos(18*pi ((x^2 + y^2)^0.5)/25) +0.0321819999 * cos(19*pi ((x^2 + y^2)^0.5)/25) -0.0186060039 * cos(20*pi ((x^2 + y^2)^0.5)/25) -0.0015307690 * cos(21*pi ((x^2 + y^2)^0.5)/25) -0.0057579207 * cos(22*pi ((x^2 + y^2)^0.5)/25) -0.0391257207 * cos(23*pi ((x^2 + y^2)^0.5)/25) -0.0059231612 * cos(24*pi ((x^2 + y^2)^0.5)/25) +0.0084387386 * cos(25*pi ((x^2 + y^2)^0.5)/25) -0.0090631796 * cos(26*pi ((x^2 + y^2)^0.5)/25) +0.0219465557 * cos(27*pi ((x^2 + y^2)^0.5)/25) +0.0255056870 * cos(28*pi ((x^2 + y^2)^0.5)/25) -0.0049334643 * cos(29*pi ((x^2 + y^2)^0.5)/25) +0.0080625933 * cos(30*pi ((x^2 + y^2)^0.5)/25) +0.0011675414 * cos(31*pi ((x^2 + y^2)^0.5)/25) -0.0271037536 * cos(32*pi ((x^2 + y^2)^0.5)/25) -0.0074703548 * cos(33*pi ((x^2 + y^2)^0.5)/25) -0.0014911901 * cos(34*pi ((x^2 + y^2)^0.5)/25) -0.0142427828 * cos(35*pi ((x^2 + y^2)^0.5)/25) +0.0121524770 * cos(36*pi ((x^2 + y^2)^0.5)/25) +0.0178515294 * cos(37*pi ((x^2 + y^2)^0.5)/25) -0.0002884619 * cos(38*pi ((x^2 + y^2)^0.5)/25) +0.0132121168 * cos(39*pi ((x^2 + y^2)^0.5)/25) +0.0068365857 * cos(40*pi ((x^2 + y^2)^0.5)/25) -0.0168060267 * cos(41*pi ((x^2 + y^2)^0.5)/25) -0.0045769675 * cos(42*pi ((x^2 + y^2)^0.5)/25) -0.0050617692 * cos(43*pi ((x^2 + y^2)^0.5)/25) -0.0170242963 * cos(44*pi ((x^2 + y^2)^0.5)/25) +0.0044827743 * cos(45*pi ((x^2 + y^2)^0.5)/25) +0.0098297471 * cos(46*pi ((x^2 + y^2)^0.5)/25) -0.0007094004 * cos(47*pi ((x^2 + y^2)^0.5)/25) +0.0143279607 * cos(48*pi ((x^2 + y^2)^0.5)/25) +0.0101039156 * cos(49*pi ((x^2 + y^2)^0.5)/25) -0.0084290205 * cos(50*pi ((x^2 + y^2)^0.5)/25) +0.0003112332 * cos(51*pi ((x^2 + y^2)^0.5)/25) -0.0044186239 * cos(52*pi ((x^2 + y^2)^0.5)/25) -0.0168284686 * cos(53*pi ((x^2 + y^2)^0.5)/25) -0.0004168660 * cos(54*pi ((x^2 + y^2)^0.5)/25) +0.0027558215 * cos(55*pi ((x^2 + y^2)^0.5)/25) -0.0036939582 * cos(56*pi ((x^2 + y^2)^0.5)/25) +0.0122800185 * cos(57*pi ((x^2 + y^2)^0.5)/25) +0.0104784219 * cos(58*pi ((x^2 + y^2)^0.5)/25) -0.0027236853 * cos(59*pi ((x^2 + y^2)^0.5)/25) +0.0052307707 * cos(60*pi ((x^2 + y^2)^0.5)/25) -0.0014623950 * cos(61*pi ((x^2 + y^2)^0.5)/25) -0.0140271448 * cos(62*pi ((x^2 + y^2)^0.5)/25) -0.0022419699 * cos(63*pi ((x^2 + y^2)^0.5)/25) -0.0022239903 * cos(64*pi ((x^2 + y^2)^0.5)/25) -0.0072020612 * cos(65*pi ((x^2 + y^2)^0.5)/25) +0.0084010330 * cos(66*pi ((x^2 + y^2)^0.5)/25) +0.0082882663 * cos(67*pi ((x^2 + y^2)^0.5)/25) -0.0000392029 * cos(68*pi ((x^2 + y^2)^0.5)/25) +0.0087223003 * cos(69*pi ((x^2 + y^2)^0.5)/25) +0.0020170672 * cos(70*pi ((x^2 + y^2)^0.5)/25) -0.0096641473 * cos(71*pi ((x^2 + y^2)^0.5)/25) -0.0013629766 * cos(72*pi ((x^2 + y^2)^0.5)/25) -0.0045490357 * cos(73*pi ((x^2 + y^2)^0.5)/25) -0.0096969841 * cos(74*pi ((x^2 + y^2)^0.5)/25) +0.0041928178 * cos(75*pi ((x^2 + y^2)^0.5)/25) +0.0045059674 * cos(76*pi ((x^2 + y^2)^0.5)/25) -0.0000623672 * cos(77*pi ((x^2 + y^2)^0.5)/25) +0.0100235984 * cos(78*pi ((x^2 + y^2)^0.5)/25) +0.0045838000 * cos(79*pi ((x^2 + y^2)^0.5)/25) -0.0050687883 * cos(80*pi ((x^2 + y^2)^0.5)/25) +0.0012615425 * cos(81*pi ((x^2 + y^2)^0.5)/25) -0.0043808618 * cos(82*pi ((x^2 + y^2)^0.5)/25) -0.0103300096 * cos(83*pi ((x^2 + y^2)^0.5)/25) +0.0009482010 * cos(84*pi ((x^2 + y^2)^0.5)/25) +0.0004015174 * cos(85*pi ((x^2 + y^2)^0.5)/25) -0.0018972540 * cos(86*pi ((x^2 + y^2)^0.5)/25) +0.0091396636 * cos(87*pi ((x^2 + y^2)^0.5)/25) +0.0054083781 * cos(88*pi ((x^2 + y^2)^0.5)/25) -0.0014417165 * cos(89*pi ((x^2 + y^2)^0.5)/25) +0.0043853655 * cos(90*pi ((x^2 + y^2)^0.5)/25) -0.0024958803 * cos(91*pi ((x^2 + y^2)^0.5)/25) -0.0090123741 * cos(92*pi ((x^2 + y^2)^0.5)/25) -0.0005585440 * cos(93*pi ((x^2 + y^2)^0.5)/25) -0.0028550339 * cos(94*pi ((x^2 + y^2)^0.5)/25) -0.0043491187 * cos(95*pi ((x^2 + y^2)^0.5)/25) +0.0067194355 * cos(96*pi ((x^2 + y^2)^0.5)/25) +0.0043749855 * cos(97*pi ((x^2 + y^2)^0.5)/25) +0.0004755794 * cos(98*pi ((x^2 + y^2)^0.5)/25) +0.0068481769 * cos(99*pi ((x^2 + y^2)^0.5)/25) -0.0063017698 * cos(101*pi ((x^2 + y^2)^0.5)/25) -0.0002127523 * cos(102*pi ((x^2 + y^2)^0.5)/25) -0.0045207249 * cos(103*pi ((x^2 + y^2)^0.5)/25) -0.0062858652 * cos(104*pi ((x^2 + y^2)^0.5)/25) +0.0037711458 * cos(105*pi ((x^2 + y^2)^0.5)/25) +0.0019933967 * cos(106*pi ((x^2 + y^2)^0.5)/25) +0.0005603652 * cos(107*pi ((x^2 + y^2)^0.5)/25) +0.0078939881 * cos(108*pi ((x^2 + y^2)^0.5)/25) +0.0020297459 * cos(109*pi ((x^2 + y^2)^0.5)/25) -0.0031296094 * cos(110*pi ((x^2 + y^2)^0.5)/25) +0.0015025734 * cos(111*pi ((x^2 + y^2)^0.5)/25) -0.0044452875 * cos(112*pi ((x^2 + y^2)^0.5)/25) -0.0069523722 * cos(113*pi ((x^2 + y^2)^0.5)/25) +0.0013074329 * cos(114*pi ((x^2 + y^2)^0.5)/25) -0.0008536753 * cos(115*pi ((x^2 + y^2)^0.5)/25) -0.0007346524 * cos(116*pi ((x^2 + y^2)^0.5)/25) +0.0073388488 * cos(117*pi ((x^2 + y^2)^0.5)/25) +0.0028597307 * cos(118*pi ((x^2 + y^2)^0.5)/25) -0.0004553469 * cos(119*pi ((x^2 + y^2)^0.5)/25) +0.0037384223 * cos(120*pi ((x^2 + y^2)^0.5)/25) -0.0030394663 * cos(121*pi ((x^2 + y^2)^0.5)/25) -0.0061419298 * cos(122*pi ((x^2 + y^2)^0.5)/25) +0.0000309441 * cos(123*pi ((x^2 + y^2)^0.5)/25) -0.0032422154 * cos(124*pi ((x^2 + y^2)^0.5)/25) -0.0025957551 * cos(125*pi ((x^2 + y^2)^0.5)/25) +0.0055480390 * cos(126*pi ((x^2 + y^2)^0.5)/25) +0.0022767956 * cos(127*pi ((x^2 + y^2)^0.5)/25) +0.0010442992 * cos(128*pi ((x^2 + y^2)^0.5)/25) +0.0055963189 * cos(129*pi ((x^2 + y^2)^0.5)/25) -0.0010738216 * cos(130*pi ((x^2 + y^2)^0.5)/25) -0.0041827092 * cos(131*pi ((x^2 + y^2)^0.5)/25) +0.0001521851 * cos(132*pi ((x^2 + y^2)^0.5)/25) -0.0045107763 * cos(133*pi ((x^2 + y^2)^0.5)/25) -0.0041514417 * cos(134*pi ((x^2 + y^2)^0.5)/25) +0.0032462929 * cos(135*pi ((x^2 + y^2)^0.5)/25) +0.0005847583 * cos(136*pi ((x^2 + y^2)^0.5)/25) +0.0011601368 * cos(137*pi ((x^2 + y^2)^0.5)/25) +0.0064241074 * cos(138*pi ((x^2 + y^2)^0.5)/25) +0.0006133566 * cos(139*pi ((x^2 + y^2)^0.5)/25) -0.0017594626 * cos(140*pi ((x^2 + y^2)^0.5)/25) +0.0013835750 * cos(141*pi ((x^2 + y^2)^0.5)/25) -0.0044454400 * cos(142*pi ((x^2 + y^2)^0.5)/25) -0.0047607348 * cos(143*pi ((x^2 + y^2)^0.5)/25) +0.0012358534 * cos(144*pi ((x^2 + y^2)^0.5)/25) -0.0015620705 * cos(145*pi ((x^2 + y^2)^0.5)/25) +0.0001640665 * cos(146*pi ((x^2 + y^2)^0.5)/25) +0.0059998533 * cos(147*pi ((x^2 + y^2)^0.5)/25) +0.0013978688 * cos(148*pi ((x^2 + y^2)^0.5)/25) +0.0003581692 * cos(149*pi ((x^2 + y^2)^0.5)/25) +0.0030945940 * cos(150*pi ((x^2 + y^2)^0.5)/25)",
          "0.4509931129 -0.0140655540 * cos(1*pi ((x^2 + y^2)^0.5)/25) -0.0044672390 * cos(2*pi ((x^2 + y^2)^0.5)/25) -0.0542988135 * cos(3*pi ((x^2 + y^2)^0.5)/25) +0.1117630844 * cos(4*pi ((x^2 + y^2)^0.5)/25) +0.1572239696 * cos(5*pi ((x^2 + y^2)^0.5)/25) -0.0510468026 * cos(6*pi ((x^2 + y^2)^0.5)/25) -0.0762308358 * cos(7*pi ((x^2 + y^2)^0.5)/25) +0.0004423028 * cos(8*pi ((x^2 + y^2)^0.5)/25) -0.0674594490 * cos(9*pi ((x^2 + y^2)^0.5)/25) -0.0414764748 * cos(10*pi ((x^2 + y^2)^0.5)/25) +0.0543383461 * cos(11*pi ((x^2 + y^2)^0.5)/25) +0.0159820846 * cos(12*pi ((x^2 + y^2)^0.5)/25) +0.0140481824 * cos(13*pi ((x^2 + y^2)^0.5)/25) +0.0574648420 * cos(14*pi ((x^2 + y^2)^0.5)/25) -0.0045475721 * cos(15*pi ((x^2 + y^2)^0.5)/25) -0.0289219376 * cos(16*pi ((x^2 + y^2)^0.5)/25) +0.0032612538 * cos(17*pi ((x^2 + y^2)^0.5)/25) -0.0345585072 * cos(18*pi ((x^2 + y^2)^0.5)/25) -0.0321819999 * cos(19*pi ((x^2 + y^2)^0.5)/25) +0.0186060039 * cos(20*pi ((x^2 + y^2)^0.5)/25) +0.0015307690 * cos(21*pi ((x^2 + y^2)^0.5)/25) +0.0057579207 * cos(22*pi ((x^2 + y^2)^0.5)/25) +0.0391257207 * cos(23*pi ((x^2 + y^2)^0.5)/25) +0.0059231612 * cos(24*pi ((x^2 + y^2)^0.5)/25) -0.0084387386 * cos(25*pi ((x^2 + y^2)^0.5)/25) +0.0090631796 * cos(26*pi ((x^2 + y^2)^0.5)/25) -0.0219465557 * cos(27*pi ((x^2 + y^2)^0.5)/25) -0.0255056870 * cos(28*pi ((x^2 + y^2)^0.5)/25) +0.0049334643 * cos(29*pi ((x^2 + y^2)^0.5)/25) -0.0080625933 * cos(30*pi ((x^2 + y^2)^0.5)/25) -0.0011675414 * cos(31*pi ((x^2 + y^2)^0.5)/25) +0.0271037536 * cos(32*pi ((x^2 + y^2)^0.5)/25) +0.0074703548 * cos(33*pi ((x^2 + y^2)^0.5)/25) +0.0014911901 * cos(34*pi ((x^2 + y^2)^0.5)/25) +0.0142427828 * cos(35*pi ((x^2 + y^2)^0.5)/25) -0.0121524770 * cos(36*pi ((x^2 + y^2)^0.5)/25) -0.0178515294 * cos(37*pi ((x^2 + y^2)^0.5)/25) +0.0002884619 * cos(38*pi ((x^2 + y^2)^0.5)/25) -0.0132121168 * cos(39*pi ((x^2 + y^2)^0.5)/25) -0.0068365857 * cos(40*pi ((x^2 + y^2)^0.5)/25) +0.0168060267 * cos(41*pi ((x^2 + y^2)^0.5)/25) +0.0045769675 * cos(42*pi ((x^2 + y^2)^0.5)/25) +0.0050617692 * cos(43*pi ((x^2 + y^2)^0.5)/25) +0.0170242963 * cos(44*pi ((x^2 + y^2)^0.5)/25) -0.0044827743 * cos(45*pi ((x^2 + y^2)^0.5)/25) -0.0098297471 * cos(46*pi ((x^2 + y^2)^0.5)/25) +0.0007094004 * cos(47*pi ((x^2 + y^2)^0.5)/25) -0.0143279607 * cos(48*pi ((x^2 + y^2)^0.5)/25) -0.0101039156 * cos(49*pi ((x^2 + y^2)^0.5)/25) +0.0084290205 * cos(50*pi ((x^2 + y^2)^0.5)/25) -0.0003112332 * cos(51*pi ((x^2 + y^2)^0.5)/25) +0.0044186239 * cos(52*pi ((x^2 + y^2)^0.5)/25) +0.0168284686 * cos(53*pi ((x^2 + y^2)^0.5)/25) +0.0004168660 * cos(54*pi ((x^2 + y^2)^0.5)/25) -0.0027558215 * cos(55*pi ((x^2 + y^2)^0.5)/25) +0.0036939582 * cos(56*pi ((x^2 + y^2)^0.5)/25) -0.0122800185 * cos(57*pi ((x^2 + y^2)^0.5)/25) -0.0104784219 * cos(58*pi ((x^2 + y^2)^0.5)/25) +0.0027236853 * cos(59*pi ((x^2 + y^2)^0.5)/25) -0.0052307707 * cos(60*pi ((x^2 + y^2)^0.5)/25) +0.0014623950 * cos(61*pi ((x^2 + y^2)^0.5)/25) +0.0140271448 * cos(62*pi ((x^2 + y^2)^0.5)/25) +0.0022419699 * cos(63*pi ((x^2 + y^2)^0.5)/25) +0.0022239903 * cos(64*pi ((x^2 + y^2)^0.5)/25) +0.0072020612 * cos(65*pi ((x^2 + y^2)^0.5)/25) -0.0084010330 * cos(66*pi ((x^2 + y^2)^0.5)/25) -0.0082882663 * cos(67*pi ((x^2 + y^2)^0.5)/25) +0.0000392029 * cos(68*pi ((x^2 + y^2)^0.5)/25) -0.0087223003 * cos(69*pi ((x^2 + y^2)^0.5)/25) -0.0020170672 * cos(70*pi ((x^2 + y^2)^0.5)/25) +0.0096641473 * cos(71*pi ((x^2 + y^2)^0.5)/25) +0.0013629766 * cos(72*pi ((x^2 + y^2)^0.5)/25) +0.0045490357 * cos(73*pi ((x^2 + y^2)^0.5)/25) +0.0096969841 * cos(74*pi ((x^2 + y^2)^0.5)/25) -0.0041928178 * cos(75*pi ((x^2 + y^2)^0.5)/25) -0.0045059674 * cos(76*pi ((x^2 + y^2)^0.5)/25) +0.0000623672 * cos(77*pi ((x^2 + y^2)^0.5)/25) -0.0100235984 * cos(78*pi ((x^2 + y^2)^0.5)/25) -0.0045838000 * cos(79*pi ((x^2 + y^2)^0.5)/25) +0.0050687883 * cos(80*pi ((x^2 + y^2)^0.5)/25) -0.0012615425 * cos(81*pi ((x^2 + y^2)^0.5)/25) +0.0043808618 * cos(82*pi ((x^2 + y^2)^0.5)/25) +0.0103300096 * cos(83*pi ((x^2 + y^2)^0.5)/25) -0.0009482010 * cos(84*pi ((x^2 + y^2)^0.5)/25) -0.0004015174 * cos(85*pi ((x^2 + y^2)^0.5)/25) +0.0018972540 * cos(86*pi ((x^2 + y^2)^0.5)/25) -0.0091396636 * cos(87*pi ((x^2 + y^2)^0.5)/25) -0.0054083781 * cos(88*pi ((x^2 + y^2)^0.5)/25) +0.0014417165 * cos(89*pi ((x^2 + y^2)^0.5)/25) -0.0043853655 * cos(90*pi ((x^2 + y^2)^0.5)/25) +0.0024958803 * cos(91*pi ((x^2 + y^2)^0.5)/25) +0.0090123741 * cos(92*pi ((x^2 + y^2)^0.5)/25) +0.0005585440 * cos(93*pi ((x^2 + y^2)^0.5)/25) +0.0028550339 * cos(94*pi ((x^2 + y^2)^0.5)/25) +0.0043491187 * cos(95*pi ((x^2 + y^2)^0.5)/25) -0.0067194355 * cos(96*pi ((x^2 + y^2)^0.5)/25) -0.0043749855 * cos(97*pi ((x^2 + y^2)^0.5)/25) -0.0004755794 * cos(98*pi ((x^2 + y^2)^0.5)/25) -0.0068481769 * cos(99*pi ((x^2 + y^2)^0.5)/25) +0.0063017698 * cos(101*pi ((x^2 + y^2)^0.5)/25) +0.0002127523 * cos(102*pi ((x^2 + y^2)^0.5)/25) +0.0045207249 * cos(103*pi ((x^2 + y^2)^0.5)/25) +0.0062858652 * cos(104*pi ((x^2 + y^2)^0.5)/25) -0.0037711458 * cos(105*pi ((x^2 + y^2)^0.5)/25) -0.0019933967 * cos(106*pi ((x^2 + y^2)^0.5)/25) -0.0005603652 * cos(107*pi ((x^2 + y^2)^0.5)/25) -0.0078939881 * cos(108*pi ((x^2 + y^2)^0.5)/25) -0.0020297459 * cos(109*pi ((x^2 + y^2)^0.5)/25) +0.0031296094 * cos(110*pi ((x^2 + y^2)^0.5)/25) -0.0015025734 * cos(111*pi ((x^2 + y^2)^0.5)/25) +0.0044452875 * cos(112*pi ((x^2 + y^2)^0.5)/25) +0.0069523722 * cos(113*pi ((x^2 + y^2)^0.5)/25) -0.0013074329 * cos(114*pi ((x^2 + y^2)^0.5)/25) +0.0008536753 * cos(115*pi ((x^2 + y^2)^0.5)/25) +0.0007346524 * cos(116*pi ((x^2 + y^2)^0.5)/25) -0.0073388488 * cos(117*pi ((x^2 + y^2)^0.5)/25) -0.0028597307 * cos(118*pi ((x^2 + y^2)^0.5)/25) +0.0004553469 * cos(119*pi ((x^2 + y^2)^0.5)/25) -0.0037384223 * cos(120*pi ((x^2 + y^2)^0.5)/25) +0.0030394663 * cos(121*pi ((x^2 + y^2)^0.5)/25) +0.0061419298 * cos(122*pi ((x^2 + y^2)^0.5)/25) -0.0000309441 * cos(123*pi ((x^2 + y^2)^0.5)/25) +0.0032422154 * cos(124*pi ((x^2 + y^2)^0.5)/25) +0.0025957551 * cos(125*pi ((x^2 + y^2)^0.5)/25) -0.0055480390 * cos(126*pi ((x^2 + y^2)^0.5)/25) -0.0022767956 * cos(127*pi ((x^2 + y^2)^0.5)/25) -0.0010442992 * cos(128*pi ((x^2 + y^2)^0.5)/25) -0.0055963189 * cos(129*pi ((x^2 + y^2)^0.5)/25) +0.0010738216 * cos(130*pi ((x^2 + y^2)^0.5)/25) +0.0041827092 * cos(131*pi ((x^2 + y^2)^0.5)/25) -0.0001521851 * cos(132*pi ((x^2 + y^2)^0.5)/25) +0.0045107763 * cos(133*pi ((x^2 + y^2)^0.5)/25) +0.0041514417 * cos(134*pi ((x^2 + y^2)^0.5)/25) -0.0032462929 * cos(135*pi ((x^2 + y^2)^0.5)/25) -0.0005847583 * cos(136*pi ((x^2 + y^2)^0.5)/25) -0.0011601368 * cos(137*pi ((x^2 + y^2)^0.5)/25) -0.0064241074 * cos(138*pi ((x^2 + y^2)^0.5)/25) -0.0006133566 * cos(139*pi ((x^2 + y^2)^0.5)/25) +0.0017594626 * cos(140*pi ((x^2 + y^2)^0.5)/25) -0.0013835750 * cos(141*pi ((x^2 + y^2)^0.5)/25) +0.0044454400 * cos(142*pi ((x^2 + y^2)^0.5)/25) +0.0047607348 * cos(143*pi ((x^2 + y^2)^0.5)/25) -0.0012358534 * cos(144*pi ((x^2 + y^2)^0.5)/25) +0.0015620705 * cos(145*pi ((x^2 + y^2)^0.5)/25) -0.0001640665 * cos(146*pi ((x^2 + y^2)^0.5)/25) -0.0059998533 * cos(147*pi ((x^2 + y^2)^0.5)/25) -0.0013978688 * cos(148*pi ((x^2 + y^2)^0.5)/25) -0.0003581692 * cos(149*pi ((x^2 + y^2)^0.5)/25) -0.0030945940 * cos(150*pi ((x^2 + y^2)^0.5)/25)"
    ],
    [red, blue],
    True
)
bellows_fgrade.set_child(bellows1)

# Translate into position:
bellows_fgrade = pv.Translate(x+mainD/2, y+mainD/2, 0, bellows_fgrade)


# Caps
cap1_mesh = pv.Mesh(
    STL_Location + "/variableNumberBellowsStack_ASSEMBLY - CloseCap-1.STL",red)
cap1fgrade = pv.FGrade(["0.95", "0.05"], [blue, red], True )
cap1fgrade.set_child(cap1_mesh)

cap2_mesh = pv.Mesh(
    STL_Location+"/variableNumberBellowsStack_ASSEMBLY - domeCap-1.STL",red)
cap2fgrade =  pv.FGrade(["0.95", "0.05"], [blue, red], True )
cap2fgrade.set_child(cap2_mesh)
cap2_mesh = cap2fgrade

cap2_mesh = pv.Translate(0,0,numStacks*mainHeight+capHeight,cap2_mesh)

# Fluid-Solid support barrier
supportBarrier1_mesh = pv.Mesh(
    STL_Location + "/variableNumberBellowsStack_ASSEMBLY - Variable_SupportBundary-1.STL",green
)

# Baffles and Fluid
fluidNoHoles1_mesh = pv.Mesh(
    STL_Location + "/variableNumberBellowsStack_ASSEMBLY - Variable_Fluid-1.STL",liquid_mat
)

if includeBaffles == True:
    fluidHoles1_mesh = pv.Mesh(
        STL_Location + "/variableNumberBellowsStack_ASSEMBLY - Variable_Fluid-2.STL",liquid_mat
    )
    baffles = pv.Difference(fluidNoHoles1_mesh,fluidHoles1_mesh)
    bafflesFgrade = pv.FGrade(['1'], [green],True)
    bafflesFgrade.set_child(baffles)

#--------------------------------------------------------
#-- Repeating each Bellows Assmbly for N Bellows Stack --
#--------------------------------------------------------
repeatUnion = pv.Union()
repeatUnion.add_child(bellows_fgrade)
repeatUnion.add_child(supportBarrier1_mesh)
if includeBaffles == True:
    repeatUnion.add_child(fluidHoles1_mesh)
    repeatUnion.add_child(bafflesFgrade)
else:
    repeatUnion.add_child(fluidNoHoles1_mesh)

fullStackUnion = pv.Union()
fullStackUnion.add_child(repeatUnion)

for i in range(numStacks-1):
    tempBellowsMesh = repeatUnion
    tempBellowsMesh = pv.Translate(0,0,mainHeight*(i+1),tempBellowsMesh)
    fullStackUnion.add_child(tempBellowsMesh)

#--------------------------------------
#-- Union of all Meshes to Root Node --
#--------------------------------------
root.add_child(fullStackUnion)
root.add_child(cap1fgrade)
root.add_child(cap2_mesh)

#-- Section View --
#tempRect = pv.RectPrism(pv.Vec3(x+mainD/2,y+mainD/2,0),pv.Vec3(mainD,mainD,4),red)
#root = pv.Difference(root,tempRect)